name: Financial Data Analyzer

on:
  workflow_dispatch:  # 允许在GitHub上手动点击运行此工作流
  schedule:
  - cron: '0 */3 * * *'

jobs:
  run-python-script:
    runs-on: ubuntu-latest  # 使用最新的 Ubuntu 操作系统环境

    steps:
    - name: Checkout code
      uses: actions/checkout@v2  # 将你的代码克隆到运行环境中

    - name: Set up Python
      uses: actions/setup-python@v2
      with:
        python-version: '3.x'  # 设置 Python 版本为 3.x

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install chardet
        pip install pandas numpy requests beautifulsoup4 lxml selenium webdriver-manager akshare

    - name: Install Chrome
      run: |
        sudo apt-get update
        sudo apt-get install -y google-chrome-stable

    - name: Run Python script
      run: python analyze_and_filter.py

    - name: Upload results
      uses: actions/upload-artifact@v4
      with:
        name: financial-data-results
        path: |
          all_index_valuation.csv
          selected_low_valuation_indices.csv
          recommended_cn_funds.csv
          comprehensive_fund_analysis.json
